<app-navadmin></app-navadmin>
<main class="container">
  <h1 class="main-title">ประวัติธุรกรรม</h1>

  <ng-container *ngIf="user; else loadingOrError">
    <section class="user-profile-card">
      <img class="avatar" [src]="getFullImageUrl(user.image_profile)" alt="User Avatar">
      <div class="user-info">
        <span class="user-name">{{ user.username }}</span>
        <span class="user-email">{{ user.email }}</span>
      </div>
      <div class="user-balance">{{ user.wallet | number: '1.2-2' }} บาท</div>
    </section>

    <div class="history-grid">
      <section class="history-card">
        <h2>ประวัติการเติมเงิน</h2>
        <ul class="history-list">
          <li *ngIf="walletHistory.length === 0" class="empty-state">ไม่มีประวัติการเติมเงิน</li>
          <li *ngFor="let item of walletHistory">
            <span>{{ item.transaction_date | date: 'dd MMM yyyy, HH:mm' }}</span>
            <span class="amount add">+{{ item.amount | number: '1.2-2' }} บาท</span>
          </li>
        </ul>
      </section>

      <section class="history-card">
        <h2>ประวัติการซื้อเกมส์</h2>
        <ul class="history-list">
          <li *ngIf="orders.length === 0" class="empty-state">ไม่มีประวัติการซื้อเกม</li>
          <ng-container *ngFor="let order of orders">
            <li *ngFor="let detail of order.order_details" class="purchase-item">
              <img class="game-cover" [src]="getFullImageUrl(detail.game.image_game)" [alt]="detail.game.title">
              <div class="game-details">
                <span class="game-name">{{ detail.game.title }}</span>
                <div class="purchase-details">
                  <span>{{ order.order_date | date: 'dd MMM yyyy' }}</span>
                  <span class="price">{{ order.final_total | number: '1.2-2' }} บาท</span>
                </div>
              </div>
            </li>
          </ng-container>
        </ul>
      </section>
    </div>

  </ng-container>

  <ng-template #loadingOrError>
    <div class="feedback-container">
      <p>{{ errorMessage || 'กำลังโหลดข้อมูล...' }}</p>
    </div>
  </ng-template>
</main>